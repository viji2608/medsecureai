<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSecureAI - Clinical Assistant</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide Icons as simple SVG components
        const Search = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );
        
        const Lock = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        );
        
        const Activity = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
        );
        
        const Database = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
            </svg>
        );
        
        const ShieldCheck = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <polyline points="9 12 11 14 15 10"></polyline>
            </svg>
        );
        
        const Clock = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );
        
        const AlertCircle = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        function MedSecureAI() {
          const [query, setQuery] = useState('');
          const [userId, setUserId] = useState('DR001');
          const [results, setResults] = useState(null);
          const [loading, setLoading] = useState(false);
          const [stats, setStats] = useState({
            totalQueries: 0,
            avgLatency: 0,
            recordsEncrypted: 200,
            successRate: 100
          });

          const API_BASE = 'http://localhost:8000';

          const loadMetrics = async () => {
            try {
              const response = await fetch(`${API_BASE}/metrics`);
              const data = await response.json();
              if (data.performance) {
                setStats(prev => ({
                  ...prev,
                  recordsEncrypted: data.performance.insert_performance?.total_records_inserted || 200,
                  totalQueries: data.performance.search_performance?.total_searches || 0
                }));
              }
            } catch (error) {
              console.log('Metrics not available yet');
            }
          };

          const handleSearch = async () => {
            if (!query.trim()) {
              alert('Please enter a query');
              return;
            }

            setLoading(true);
            
            try {
              const response = await fetch(`${API_BASE}/query`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  question: query,
                  user_id: userId,
                  top_k: 5
                })
              });

              const data = await response.json();
              setResults(data);
              
              setStats(prev => ({
                ...prev,
                totalQueries: prev.totalQueries + 1,
                avgLatency: Math.round(data.latency_ms)
              }));
              
              loadMetrics();
            } catch (error) {
              setResults({
                error: true,
                message: 'Connection failed. Make sure the API is running on localhost:8000'
              });
            } finally {
              setLoading(false);
            }
          };

          useEffect(() => {
            loadMetrics();
          }, []);

          const exampleQueries = [
            "What are treatment options for Type 2 Diabetes in elderly patients?",
            "How to manage hypertension with comorbid conditions?",
            "Drug interactions between Metformin and Lisinopril?",
            "Treatment protocol for congestive heart failure?"
          ];

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
              {/* Header */}
              <header className="bg-white shadow-sm border-b border-gray-200">
                <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-2 rounded-lg">
                        <ShieldCheck className="w-8 h-8 text-white" />
                      </div>
                      <div>
                        <h1 className="text-2xl font-bold text-gray-900">MedSecureAI</h1>
                        <p className="text-sm text-gray-600">HIPAA-Compliant Clinical Assistant with CyborgDB</p>
                      </div>
                    </div>
                    <div className="flex items-center space-x-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg">
                      <Lock className="w-4 h-4 text-green-600" />
                      <span className="text-sm font-medium text-green-700">256-bit AES Encryption</span>
                    </div>
                  </div>
                </div>
              </header>

              {/* Stats Bar */}
              <div className="bg-white border-b border-gray-200">
                <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
                  <div className="grid grid-cols-4 gap-4">
                    <div className="text-center">
                      <div className="text-2xl font-bold text-blue-600">{stats.totalQueries}</div>
                      <div className="text-xs text-gray-600">Total Queries</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-green-600">{stats.avgLatency}ms</div>
                      <div className="text-xs text-gray-600">Avg Response</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-purple-600">{stats.recordsEncrypted}</div>
                      <div className="text-xs text-gray-600">Records Encrypted</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-indigo-600">{stats.successRate}%</div>
                      <div className="text-xs text-gray-600">Success Rate</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <main className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
                {/* Search Section */}
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Clinician ID:
                    </label>
                    <input
                      type="text"
                      value={userId}
                      onChange={(e) => setUserId(e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Enter clinician ID"
                    />
                  </div>

                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Clinical Query:
                    </label>
                    <textarea
                      value={query}
                      onChange={(e) => setQuery(e.target.value)}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                      rows="4"
                      placeholder="Enter your clinical question..."
                    />
                  </div>

                  {/* Example Queries */}
                  <div className="mb-4">
                    <p className="text-xs text-gray-600 mb-2">Try these examples:</p>
                    <div className="flex flex-wrap gap-2">
                      {exampleQueries.map((example, idx) => (
                        <button
                          key={idx}
                          onClick={() => setQuery(example)}
                          className="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-colors"
                        >
                          {example.substring(0, 50)}...
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="flex space-x-3">
                    <button
                      onClick={handleSearch}
                      disabled={loading}
                      className="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center space-x-2"
                    >
                      {loading ? (
                        <>
                          <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                          <span>Searching Encrypted Database...</span>
                        </>
                      ) : (
                        <>
                          <Search className="w-5 h-5" />
                          <span>üîç Search Encrypted Database</span>
                        </>
                      )}
                    </button>
                    <button
                      onClick={() => { setQuery(''); setResults(null); }}
                      className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                    >
                      Clear
                    </button>
                  </div>
                </div>

                {/* Results Section */}
                {results && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                      <Activity className="w-6 h-6 mr-2 text-blue-600" />
                      Results
                    </h2>

                    {results.error ? (
                      <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div className="flex items-center space-x-2 text-red-800">
                          <AlertCircle className="w-5 h-5" />
                          <span className="font-semibold">Connection Error</span>
                        </div>
                        <p className="text-sm text-red-700 mt-2">{results.message}</p>
                      </div>
                    ) : (
                      <>
                        {/* Main Answer */}
                        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                              ü§ñ Clinical Assistant
                            </h3>
                            <span className="text-xs text-gray-500">Query ID: {results.query_id}</span>
                          </div>
                          <div className="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap">
                            {results.answer}
                          </div>
                          <div className="mt-4 flex items-center text-sm text-gray-600">
                            <Clock className="w-4 h-4 mr-1" />
                            <span>‚è±Ô∏è Response time: {results.latency_ms.toFixed(1)}ms</span>
                          </div>
                        </div>

                        {/* Source Records */}
                        {results.sources && results.sources.length > 0 && (
                          <div className="mt-8">
                            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                              <Database className="w-5 h-5 mr-2 text-blue-600" />
                              üìö Source Records
                            </h3>
                            <div className="space-y-3">
                              {results.sources.map((source, idx) => (
                                <div key={idx} className="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                  <div className="flex items-center justify-between mb-2">
                                    <span className="text-sm font-medium text-gray-700">
                                      Record {idx + 1}
                                    </span>
                                    <div className="flex items-center space-x-2">
                                      <span className="text-sm text-gray-500">Similarity:</span>
                                      <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                                        {((1 - source.score) * 100).toFixed(1)}%
                                      </span>
                                    </div>
                                  </div>
                                  <p className="text-sm text-gray-700 leading-relaxed">
                                    {source.summary || source.text.substring(0, 200)}
                                  </p>
                                  <div className="mt-2 flex items-center text-xs text-gray-500">
                                    <Lock className="w-3 h-3 mr-1" />
                                    <span>Encrypted Record ID: {source.id.substring(0, 12)}...</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Security Info */}
                        <div className="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
                          <h4 className="font-semibold text-green-900 mb-2 flex items-center">
                            <ShieldCheck className="w-5 h-5 mr-2" />
                            üîí Security & Privacy
                          </h4>
                          <ul className="space-y-1 text-sm text-green-800">
                            <li>‚úì Query encrypted before transmission</li>
                            <li>‚úì Vector search on encrypted data (CyborgDB)</li>
                            <li>‚úì Results decrypted only in secure memory</li>
                            <li>‚úì Complete HIPAA audit trail maintained</li>
                          </ul>
                        </div>

                        {/* Metrics */}
                        <div className="mt-6 grid grid-cols-4 gap-4">
                          <div className="bg-gray-50 rounded-lg p-3 text-center">
                            <div className="text-2xl font-bold text-blue-600">{stats.totalQueries}</div>
                            <div className="text-xs text-gray-600">Total Ops</div>
                          </div>
                          <div className="bg-gray-50 rounded-lg p-3 text-center">
                            <div className="text-2xl font-bold text-green-600">{stats.avgLatency}ms</div>
                            <div className="text-xs text-gray-600">Avg Query</div>
                          </div>
                          <div className="bg-gray-50 rounded-lg p-3 text-center">
                            <div className="text-2xl font-bold text-purple-600">{stats.recordsEncrypted}</div>
                            <div className="text-xs text-gray-600">Records</div>
                          </div>
                          <div className="bg-gray-50 rounded-lg p-3 text-center">
                            <div className="text-2xl font-bold text-indigo-600">{results.sources?.length || 0}</div>
                            <div className="text-xs text-gray-600">Searches</div>
                          </div>
                        </div>
                      </>
                    )}
                  </div>
                )}
              </main>

              {/* Footer */}
              <footer className="bg-white border-t border-gray-200 mt-12">
                <div className="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                  <div className="text-center text-sm text-gray-600">
                    <p>MedSecureAI v2.0 - Production-Ready HIPAA-Compliant Medical AI</p>
                    <p className="text-xs mt-1">üîê Powered by CyborgDB with Real 256-bit AES Encryption</p>
                  </div>
                </div>
              </footer>
            </div>
          );
        }

        ReactDOM.render(<MedSecureAI />, document.getElementById('root'));
    </script>
</body>
</html>
